name: Fedora Build Image

on: workflow_dispatch

env:
  IMAGE_TAG: $(date +%s)

jobs:
  build-fedora-image:
    runs-on: ubuntu-20.04

    steps:
    - name: Checkout source
      uses: actions/checkout@v3

    - name: Build Fedora image
      run: docker build --file devops/Dockerfile.fedora --tag fit-fedora:${{ env.IMAGE_TAG }}

    - name: Docker Login
      uses: docker/login-action@v2.0.0
      with:
        registry: ghcr.io
        username: ${{ github.actor }}
        password: ${{ secrets.GITHUB_TOKEN }}

    - name: Push Fedora image
      run: docker push ghcr.io/fit-fedora:${{ env.IMAGE_TAG }}
